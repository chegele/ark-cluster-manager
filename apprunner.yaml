version: 1.0
runtime: nodejs16
build:
  commands:
    pre-build:
      - npm install -g @angular/cli
    build:    
      - echo frontend install
      - cd frontend && npm i
      - echo angular update
      - ng update
      - echo frontend build
      - npm run build
      - echo frontend cleanup skip
      - echo backend build
      - cd .. && cd backend
      - touch .env
      - ls -lrth
      - npm run prod
run:
  command: npm run prod --prefix backend
  network: 
    port: 3000
  env:
    - name: DB_STRING
      value: "mongodb+srv://ark-admin:LbBzpYhd9bVSfdmw@ark-clusters-test-pe-0.nch8eum.mongodb.net/?retryWrites=true&w=majority"
    - name: AWS_ACCESS_KEY_ID
      value: "AKIA3CWG6LI2O7OQPOUW"
    - name: AWS_SECRET_ACCESS_KEY
      value: "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"
    - name: AWS_REGION
      value: "us-east-1"
    - name: LOG_LEVEL
      value: "debug"
    - name: LOG_TO_CONSOLE
      value: "true"
    - name: LOG_TO_FILE
      value: "true"
    - name: LOG_FILE_PATH
      value: "./logs/output.log"